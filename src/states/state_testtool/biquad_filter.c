//---------------------------------------------------------------------------------------------------------------------------
/*

 * biquad_filter.c
 *
 *  Created on: 5 sie 2015
 *      Author: Tomasz Szleter
 */
//---------------------------------------------------------------------------------------------------------------------------
#include "biquad_filter.h"
//---------------------------------------------------------------------------------------------------------------------------
int64_t biquad_insert(BIQUAD *bq, int64_t sample) {

	int64_t tmp = sample*bq->b0 + bq->zi1*bq->b1 + bq->zi2*bq->b2 - bq->out*bq->a1 - bq->zo*bq->a2;
	tmp /= bq->den;

	bq->zi2 = bq->zi1;
	bq->zi1 = sample;

	bq->zo = bq->out;
	bq->out = tmp;

	//volatile int64_t tmp, tmp2;

	//tmp = (bq->den*sample) - (bq->a1*bq->z1) - (bq->a2*bq->z2);
	//tmp /= bq->den;

	//tmp2 = bq->b0*tmp + bq->b1*bq->z1 + bq->b2*bq->z2;
	//tmp2 /= bq->den;

	//bq->z2 = bq->z1;
	//bq->z1 = tmp;
	//bq->out = tmp2;

	//if (tmp2 > 32000 || tmp2 < -32000) {
	//	tmp2++;
	//}

	return tmp;
}
//---------------------------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------

